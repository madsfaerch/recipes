---
import { getCollection } from 'astro:content';
import { render } from 'astro:content';
import Base from '../layouts/Base.astro';
import RecipeSearch from '../components/RecipeSearch.tsx';

const recipes = (await getCollection('recipes')).sort(
  (a, b) => (b.data.added?.getTime() ?? 0) - (a.data.added?.getTime() ?? 0)
);

// Build search index data
const searchData = await Promise.all(
  recipes.map(async (recipe) => {
    const { remarkPluginFrontmatter } = await render(recipe);
    return {
      id: recipe.id,
      title: recipe.data.title,
      description: recipe.data.description,
      tags: recipe.data.tags,
      cuisine: recipe.data.cuisine,
      shoppingIngredients: recipe.data.shoppingIngredients,
      author: recipe.data.author,
      image: recipe.data.image,
      cookTime: recipe.data.cookTime,
      prepTime: recipe.data.prepTime,
    };
  })
);
---

<Base title="All Recipes">
  <RecipeSearch client:load recipes={searchData} />
</Base>
